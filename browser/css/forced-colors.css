@media (forced-colors: active) {

	/* Active notebookbar tab: box-shadow is stripped, use border-bottom */
	.ui-tab.selected.notebookbar,
	.main-nav.hasnotebookbar .ui-tabs > .ui-tab.selected.notebookbar {
		border: 2px solid Highlight !important;
		box-shadow: none !important;
		background-color: Highlight !important;
	}

	.ui-tab.selected.notebookbar:hover {
		box-shadow: none !important;
		border-bottom: 3px solid Highlight !important
	}

	.ui-tab.notebookbar:hover {
		box-shadow: none !important;
		border-bottom: 3px solid ButtonBorder !important
	}

	/* Preserve SVG toolbar icons */
	.unobutton img,
	.savemodified.unotoolbutton .unobutton img,
	.StyleListPanel #TemplatePanel button,
	.document-logo,
	.ui-tabs-content .unobutton > img,
	.unotoolbutton.notebookbar .unobutton > img,
	.unotoolbutton.notebookbar .unobutton {
		forced-color-adjust: none;
		background-color: #e9e9ed;
	}

	/* Restore native checkboxes (OS renders in user's HC colors) */
	input[type='checkbox'].autofilter,
	.jsdialog input[type='checkbox'] {
		appearance: auto !important;
		-webkit-appearance: auto !important;
		-moz-appearance: auto !important;
		background: none !important
	}

	/* Shortcuts buttons: small save icon etc */
	.notebookbar-shortcuts-bar .unotoolbutton.notebookbar .unobutton {
		forced-color-adjust: auto;
	}

	/* Dropdown arrows */
	.unoarrow, .menubutton .arrow, .ui-listbox-arrow {
		forced-color-adjust: none;
		border-top-color: #e9e9ed;
	}

	/* Restore original Sidebar expanders */
	.ui-expander-label.expanded::before,
	.ui-treeview-expandable:not(.collapsed) > div > .ui-treeview-expander::before,
	.ui-treeview div[aria-expanded='true'] > div > .ui-treeview-expander::before {
		forced-color-adjust: none;
		filter: none;
	}

	/* Color picker swatches and selected-color indicator */
	.ui-color-picker-entry,
	.unotoolbutton .selected-color {
		forced-color-adjust: none;
	}

	/* Styles sidebar: specificity boost over [id] button rules */
	.StyleListPanel #TemplatePanel [id] button {
		forced-color-adjust: none;
		background-color: #e9e9ed;
	}

	/* Style preview images in sidebar treeview */
	.StyleListPanel .ui-treeview-entry img {
		forced-color-adjust: none;
	}

	/* Comment/annotation action buttons (SVG background icons) */
	.cool-annotation-menu,
	.cool-annotation-menu-redline,
	.cool-annotation-menu-edit,
	.cool-redline-accept-button,
	.cool-redline-reject-button {
		forced-color-adjust: none;
		background-color: #e9e9ed !important;
	}

	/* Overflow popup icons */
	.ui-overflow-group-popup .unobutton > img {
		forced-color-adjust: none;
		background-color: #e9e9ed;
	}

	/* Dark mode: invert hardcoded light backgrounds for icon visibility */
	[data-theme='dark'] .unobutton img,
	[data-theme='dark'] .savemodified.unotoolbutton .unobutton img,
	[data-theme='dark'] .StyleListPanel #TemplatePanel button,
	[data-theme='dark'] .document-logo,
	[data-theme='dark'] .ui-tabs-content .unobutton > img,
	[data-theme='dark'] .unotoolbutton.notebookbar .unobutton > img,
	[data-theme='dark'] .unotoolbutton.notebookbar .unobutton,
	[data-theme='dark'] .StyleListPanel #TemplatePanel [id] button,
	[data-theme='dark'] .ui-overflow-group-popup .unobutton > img {
		background-color: #1E1E1E;
	}

	[data-theme='dark'] .cool-annotation-menu,
	[data-theme='dark'] .cool-annotation-menu-redline,
	[data-theme='dark'] .cool-annotation-menu-edit,
	[data-theme='dark'] .cool-redline-accept-button,
	[data-theme='dark'] .cool-redline-reject-button {
		background-color: #1E1E1E !important;
	}

	[data-theme='dark'] .unoarrow,
	[data-theme='dark'] .menubutton .arrow,
	[data-theme='dark'] .ui-listbox-arrow {
		border-top-color: #1E1E1E;
	}

	/* Dark mode: restore brightness for sidebar expanders (filter: none
	   overrides dark mode's brightness(1), leaving dark chevron on dark bg) */
	[data-theme='dark'] .ui-expander-label.expanded::before,
	[data-theme='dark'] .ui-treeview-expandable:not(.collapsed) > div > .ui-treeview-expander::before,
	[data-theme='dark'] .ui-treeview div[aria-expanded='true'] > div > .ui-treeview-expander::before {
		filter: brightness(1);
	}

}
